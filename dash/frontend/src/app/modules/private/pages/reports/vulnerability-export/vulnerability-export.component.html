<div class="row h-xs-100 display-xs-block overflow-xs-auto me-xs-1">
  <div class="col-xs my-xs-7 ms-xs-7">
    <p class="font-size-xs-26 vertical-align-xs-bottom">Vulnerability Export</p>
    <mat-card class="mb-xs-3">
      <mat-card-header>
        <p class="font-xs-500 ms-xs-6">Report Settings</p>
      </mat-card-header>
      <mat-card-content>
        <div class="display-xs-flex width-xs-100 ps-xs-15">
          <form (ngSubmit)="rebuildWithFilters()">
            <div class="row width-xs-100">
              <div class="col-xs-12 col-sm-6 col-md-3">
                <mat-form-field appearance="fill" [formGroup]="filterForm">
                  <mat-label>Entries to preview</mat-label>
                  <input matInput type="number" formControlName="limit">
                </mat-form-field>
              </div>
              <div class="col-xs-12 col-sm-6 col-md-3">
                <mat-form-field appearance="fill" [formGroup]="filterForm">
                  <mat-label>Fix available</mat-label>
                  <mat-select formControlName="fixAvailable">
                    <mat-option>--</mat-option>
                    <mat-option [value]="true">Yes</mat-option>
                    <mat-option [value]="false">No</mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div class="col-xs-12 col-sm-6 col-md-3">
                <mat-form-field appearance="fill" [formGroup]="filterForm">
                  <mat-label>Severity levels</mat-label>
                  <mat-select formControlName="severityLevels"
                              multiple>
                    <mat-option *ngFor="let level of vulnerabilitySeverities"
                                [value]="level">
                      {{ level }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
              <div class="col-xs-12 col-sm-6 col-md-3">
                <mat-form-field appearance="fill" [formGroup]="filterForm">
                  <mat-label>Enter a date</mat-label>
                  <input matInput [matDatepicker]="dp3" disabled formControlName="date">
                  <mat-datepicker-toggle matSuffix [for]="dp3"></mat-datepicker-toggle>
                  <mat-datepicker #dp3 disabled="false"></mat-datepicker>
                </mat-form-field>
              </div>
              <div class="col-xs-12">
                <mat-form-field class="width-xs-100" appearance="fill" [formGroup]="filterForm">
                  <mat-label>Namespaces</mat-label>
                  <mat-select formControlName="namespaces"
                              multiple>
                    <mat-option *ngFor="let namespace of clusterNamespaces"
                                [value]="namespace">
                      {{ namespace }}
                    </mat-option>
                  </mat-select>
                </mat-form-field>
              </div>
            </div>
            <div class="row vulnerability-filter-button">
              <button [disabled]="!filtersValid"
                      mat-raised-button
                      color="primary"
                      type="submit">Search
              </button>
            </div>
          </form>
        </div>
      </mat-card-content>
    </mat-card>
    <mat-card>
      <mat-card-header>
        <div class="row width-xs-100">
          <div class="col-xs-10 display-print-block">
            <p class="font-xs-500 ms-xs-6">Displaying {{ limit }} out of {{ vulnerabilityCount }}
              vulnerabilities</p>
          </div>
          <div class="col-xs-2 end-xs ms-xs-0 mt-xs-2 display-print-none">
            <button (click)="downloadReport()"
                    mat-mini-fab
                    color="primary"
                    class="mb-xs-2"
                    matTooltip="Download Report"
                    type="button">
              <mat-icon>save_alt</mat-icon>
            </button>
          </div>
        </div>
      </mat-card-header>
      <mat-card-content class="overflow-x-xs-auto display-xs-flex">
        <mat-table [dataSource]="dataSource" class="display-xs-table">
          <ng-container matColumnDef="image" class="column-word-break">
            <mat-header-cell *matHeaderCellDef>Image</mat-header-cell>
            <mat-cell *matCellDef="let vulnerability">{{ vulnerability.image }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="imageId">
            <mat-header-cell *matHeaderCellDef>Image Id</mat-header-cell>
            <mat-cell *matCellDef="let vulnerability">{{ vulnerability.imageId }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="type" class="column-word-break">
            <mat-header-cell *matHeaderCellDef>CVE</mat-header-cell>
            <mat-cell *matCellDef="let vulnerability">{{ vulnerability.type }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="package" class="column-word-break">
            <mat-header-cell *matHeaderCellDef>Package</mat-header-cell>
            <mat-cell *matCellDef="let vulnerability">{{ vulnerability.data?.PkgName }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="scannerName">
            <mat-header-cell *matHeaderCellDef>Scanner</mat-header-cell>
            <mat-cell *matCellDef="let vulnerability">{{ vulnerability.scannerName }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="runningInCluster">
            <mat-header-cell *matHeaderCellDef>Running</mat-header-cell>
            <mat-cell *matCellDef="let vulnerability">
              <app-readonly-checkbox [checked]="vulnerability.runningInCluster"></app-readonly-checkbox>
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef="isFixable">
            <mat-header-cell *matHeaderCellDef>Fix available</mat-header-cell>
            <mat-cell *matCellDef="let vulnerability">
              <app-readonly-checkbox [checked]="vulnerability.isFixable"></app-readonly-checkbox>
            </mat-cell>
          </ng-container>
          <ng-container matColumnDef="severity">
            <mat-header-cell *matHeaderCellDef>Severity</mat-header-cell>
            <mat-cell *matCellDef="let vulnerability">{{ vulnerability.severity }}</mat-cell>
          </ng-container>
          <ng-container matColumnDef="namespaces">
            <mat-header-cell *matHeaderCellDef>Namespace(s)</mat-header-cell>
            <mat-cell *matCellDef="let vulnerability">{{ vulnerability.namespaces }}</mat-cell>
          </ng-container>

          <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
          <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
        </mat-table>
      </mat-card-content>
    </mat-card>
  </div>
</div>

