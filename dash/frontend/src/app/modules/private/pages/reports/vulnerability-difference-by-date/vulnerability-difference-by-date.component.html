<div class="row h-xs-100 display-xs-block overflow-xs-auto me-xs-1">
  <div class="col-xs my-xs-7 ms-xs-7">
    <p class="font-size-xs-26 vertical-align-xs-bottom">Vulnerability Difference By Date</p>
    <mat-card class="mb-xs-3">
      <mat-card-header>
        <p class="font-xs-500  ms-xs-6">Report Settings</p>
      </mat-card-header>
      <mat-card-content>
        <form class="width-xs-100 ms-xs-3" (ngSubmit)="onSubmit()">
          <div class="row width-xs-100">
            <div class="col-xs-12 col-sm-6 col-md-3">
              <mat-form-field appearance="fill" [formGroup]="filterForm">
                <mat-label>Fix available</mat-label>
                <mat-select formControlName="fixAvailable">
                  <mat-option>--</mat-option>
                  <mat-option [value]="true">Yes</mat-option>
                  <mat-option [value]="false">No</mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-xs-12 col-sm-6 col-md-3">
              <mat-form-field appearance="fill" [formGroup]="filterForm">
                <mat-label>Severity levels</mat-label>
                <mat-select formControlName="severityLevels"
                            multiple>
                  <mat-option *ngFor="let level of vulnerabilitySeverities"
                              [value]="level">
                    {{ level }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>

            <div class="col-xs-12 col-sm-6">
              <mat-form-field class="width-xs-100" appearance="fill" [formGroup]="filterForm">
                <mat-label>Namespaces</mat-label>
                <mat-select formControlName="namespaces"
                            multiple>
                  <mat-option *ngFor="let namespace of clusterNamespaces"
                              [value]="namespace">
                    {{ namespace }}
                  </mat-option>
                </mat-select>
              </mat-form-field>
            </div>
            <div class="col-xs-12 col-sm-6">
              <mat-form-field appearance="fill" [formGroup]="filterForm">
                <mat-label>Start Date</mat-label>
                <input matInput [matDatepicker]="startPicker" disabled formControlName="startDate">
                <mat-datepicker-toggle matSuffix [for]="startPicker"></mat-datepicker-toggle>
                <mat-datepicker #startPicker disabled="false"></mat-datepicker>
              </mat-form-field>
            </div>
            <div class="col-xs-12 col-sm-6">
              <mat-form-field appearance="fill" [formGroup]="filterForm">
                <mat-label>End Date</mat-label>
                <input matInput [matDatepicker]="endPicker" disabled formControlName="endDate">
                <mat-datepicker-toggle matSuffix [for]="endPicker"></mat-datepicker-toggle>
                <mat-datepicker #endPicker disabled="false"></mat-datepicker>
              </mat-form-field>
            </div>
          </div>
          <div class="row">
            <div class="col-xs-6">
              <button [disabled]="!filtersValid"
                      class="search-button"
                      mat-raised-button
                      color="primary"
                      type="submit">Search
              </button>
            </div>
            <div
              class="col-xs-6 display-xs-flex
                         justify-content-xs-right
                         pr-xs-15 align-content-xs-center
                         align-items-xs-center report-settings-download-button">
              <button [disabled]="!previousRequest"
                      (click)="downloadReport()"
                      class="display-print-none"
                      mat-raised-button
                      color="primary"
                      type="button">Download
              </button>
            </div>
          </div>
        </form>
      </mat-card-content>
    </mat-card>

    <mat-card class="overflow-xs-auto mb-xs-3">
      <mat-card-header>
        <div class="width-xs-100 row">
          <div class="col-xs-9">
            <p class="font-xs-500">Total Vulnerabilities</p>
          </div>
          <div class="expand-button col-xs-3" (click)="showBarChart = !showBarChart">
            <mat-icon>{{ showBarChart ? 'expand_less' : 'expand_more' }}</mat-icon>
          </div>
        </div>
      </mat-card-header>
      <mat-card-content [@openClose]="showBarChart ? 'open' : 'close'" class="overflow-x-xs-auto display-xs-auto">
        <div class="padding-top-10" *ngIf="barChartAttributes.results?.length === 0">
          No Data to Display
        </div>
        <div class="row display-xs-flex" *ngIf="barChartAttributes.results?.length > 0">
          <div class="col-xs-12 graph dark-theme">
            <ngx-charts-bar-vertical-stacked
              [view]="barChartAttributes.view"
              [scheme]="barChartAttributes.colorScheme"
              [results]="barChartAttributes.results"
              [legend]="barChartAttributes.showLegend"
              [legendPosition]="barChartAttributes.legendPosition"
              [gradient]="barChartAttributes.gradient"
              [xAxis]="barChartAttributes.showXAxis"
              [yAxis]="barChartAttributes.showYAxis"
              [barPadding]="barChartAttributes.barPadding"
              [showXAxisLabel]="barChartAttributes.showXAxis"
              [showYAxisLabel]="barChartAttributes.showYAxis"
              [xAxisLabel]="barChartAttributes.xAxisLabel"
              [yAxisLabel]="barChartAttributes.yAxisLabel">
              <ng-template #tooltipTemplate let-model="model">
                <span>Date: {{ model.date | date: 'mediumDate' }}</span>
                <br/>
                <span>Type: {{ model.name }}</span>
                <br/>
                <span>Vulnerabilities: {{ model.value }}</span>
              </ng-template>
            </ngx-charts-bar-vertical-stacked>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card class="mb-xs-3" id="new-vulnerabilities-card">
      <mat-card-header>
        <div class="row width-xs-100 ">
          <div class="col-xs-9">
            <p class="font-xs-500">New Vulnerabilities</p>
            <div class="loader-container">
              <ngx-ui-loader [loaderId]="'report-difference-by-date-new-vulns-loader'"
                             [bgsType]="loaderConfig.bgsType"
                             [bgsPosition]="loaderConfig.bgsPosition">
              </ngx-ui-loader>
            </div>
          </div>
          <div class="expand-button col-xs-3" (click)="showNewVulnTable = !showNewVulnTable">
            <mat-icon>{{ showNewVulnTable ? 'expand_less' : 'expand_more' }}</mat-icon>
          </div>
        </div>
      </mat-card-header>
      <mat-card-content [@openClose]="showNewVulnTable ? 'open' : 'close'"
                        class="overflow-x-xs-auto display-xs-auto">
        <div class="pt-xs-10" *ngIf="!numNewVulns">
          No Vulnerabilities to display
        </div>
        <div class="background-xs-white" *ngIf="numNewVulns">
          <p class="font-xs-500 pt-xs-10">
            Displaying {{ newVulnDataSource.data.length }} of {{ numNewVulns }} vulnerabilities
          </p>
          <mat-table [dataSource]="newVulnDataSource" class="display-xs-table">
            <ng-container matColumnDef="image" class="column-word-break">
              <mat-header-cell *matHeaderCellDef>Image</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">
                <app-ellipsis-text [text]="vulnerability.image"></app-ellipsis-text>
              </mat-cell>
            </ng-container>
            <ng-container matColumnDef="imageId">
              <mat-header-cell *matHeaderCellDef>Image Id</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">{{ vulnerability.imageId }}</mat-cell>
            </ng-container>
            <ng-container matColumnDef="type" class="column-word-break">
              <mat-header-cell *matHeaderCellDef>CVE</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">{{ vulnerability.type }}</mat-cell>
            </ng-container>
            <ng-container matColumnDef="scannerName">
              <mat-header-cell *matHeaderCellDef>Scanner</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">{{ vulnerability.scannerName }}</mat-cell>
            </ng-container>
            <ng-container matColumnDef="runningInCluster">
              <mat-header-cell *matHeaderCellDef>Running</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">
                <app-readonly-checkbox [checked]="vulnerability.runningInCluster"></app-readonly-checkbox>
              </mat-cell>
            </ng-container>
            <ng-container matColumnDef="isFixable">
              <mat-header-cell *matHeaderCellDef>Fix available</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">
                <app-readonly-checkbox [checked]="vulnerability.isFixable"></app-readonly-checkbox>
              </mat-cell>
            </ng-container>
            <ng-container matColumnDef="severity">
              <mat-header-cell *matHeaderCellDef>Severity</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">{{ vulnerability.severity }}</mat-cell>
            </ng-container>
            <ng-container matColumnDef="namespaces">
              <mat-header-cell *matHeaderCellDef>Namespace(s)</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">
                <app-ellipsis-text [text]="vulnerability.namespaces"></app-ellipsis-text>
              </mat-cell>
            </ng-container>

            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
          </mat-table>
        </div>
      </mat-card-content>
    </mat-card>

    <mat-card id="fixed-vulnerabilities-card">
      <mat-card-header>
        <div class="width-xs-100 row">
          <div class="col-xs-9">
            <p class="font-xs-500">Fixed Vulnerabilities</p>
            <div class="loader-container">
              <ngx-ui-loader [loaderId]="'report-difference-by-date-old-vulns-loader'"
                             [bgsType]="loaderConfig.bgsType" [bgsPosition]="loaderConfig.bgsPosition">
              </ngx-ui-loader>
            </div>
          </div>
          <div class="expand-button col-xs-3" (click)="showFixedVulnTable = !showFixedVulnTable">
            <mat-icon>{{ showFixedVulnTable ? 'expand_less' : 'expand_more' }}</mat-icon>
          </div>
        </div>
      </mat-card-header>
      <mat-card-content [@openClose]="showFixedVulnTable ? 'open' : 'close'"
                        class="overflow-x-xs-auto display-xs-auto">
        <div class="pt-xs-10" *ngIf="!numFixedVulns">
          No Vulnerabilities to display
        </div>
        <div class="background-xs-white" *ngIf="numFixedVulns">
          <div class="pt-xs-10">
            <p class="font-xs-500">
              Displaying {{ fixedVulnDataSource.data.length }} of {{ numFixedVulns }} vulnerabilities
            </p>
          </div>
          <mat-table [dataSource]="fixedVulnDataSource" class="display-xs-table">
            <ng-container matColumnDef="image" class="column-word-break">
              <mat-header-cell *matHeaderCellDef>Image</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">
                <app-ellipsis-text [text]="vulnerability.image"></app-ellipsis-text>
              </mat-cell>
            </ng-container>
            <ng-container matColumnDef="imageId">
              <mat-header-cell *matHeaderCellDef>Image Id</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">{{ vulnerability.imageId }}</mat-cell>
            </ng-container>
            <ng-container matColumnDef="type" class="column-word-break">
              <mat-header-cell *matHeaderCellDef>CVE</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">{{ vulnerability.type }}</mat-cell>
            </ng-container>
            <ng-container matColumnDef="scannerName">
              <mat-header-cell *matHeaderCellDef>Scanner</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">{{ vulnerability.scannerName }}</mat-cell>
            </ng-container>
            <ng-container matColumnDef="runningInCluster">
              <mat-header-cell *matHeaderCellDef>Running</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">
                <app-readonly-checkbox [checked]="vulnerability.runningInCluster"></app-readonly-checkbox>
              </mat-cell>
            </ng-container>
            <ng-container matColumnDef="isFixable">
              <mat-header-cell *matHeaderCellDef>Fix available</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">
                <app-readonly-checkbox [checked]="vulnerability.isFixable"></app-readonly-checkbox>
              </mat-cell>
            </ng-container>
            <ng-container matColumnDef="severity">
              <mat-header-cell *matHeaderCellDef>Severity</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">{{ vulnerability.severity }}</mat-cell>
            </ng-container>
            <ng-container matColumnDef="namespaces">
              <mat-header-cell *matHeaderCellDef>Namespace(s)</mat-header-cell>
              <mat-cell *matCellDef="let vulnerability">
                <app-ellipsis-text [text]="vulnerability.namespaces"></app-ellipsis-text>
              </mat-cell>
            </ng-container>

            <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
            <mat-row *matRowDef="let row; columns: displayedColumns;"></mat-row>
          </mat-table>
        </div>
      </mat-card-content>

    </mat-card>
  </div>
</div>
