<div class="cluster-summary-container">
  <div class="cluster-summary">
    <div class="counter-container">
      <div class="row">
        <div class="widget margin-top-10 no-padding no-margin full-height"
             [ngClass]="this.currentCardSize">
          <mat-card appearance="outlined" class="cluster-summary-card">
            <mat-card-content>
              <div class="label">Total Images Running</div>
              <div class="total">{{ countOfTotalImagesRunning }}</div>
            </mat-card-content>
          </mat-card>
        </div>
        <div class="widget margin-top-10 no-padding no-margin full-height"
             [ngClass]="this.currentCardSize">
          <mat-card appearance="outlined" class="cluster-summary-card">
            <mat-card-content>
              <div class="label center-xs">Total Vulnerabilities Detected in Running Images</div>
              <div class="total center-xs">{{totalVulnerabilities}}</div>
            </mat-card-content>
          </mat-card>
        </div>
        <div class="widget margin-top-10 no-padding no-margin full-height"
             [ngClass]="this.currentCardSize">
          <mat-card appearance="outlined" class="cluster-summary-card">
            <mat-card-content>
              <div class="label">Policy Violations</div>
              <div class="total">{{countOfPolicyViolations}}</div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </div>
    <div class="graph-container">
      <div class="row">
        <div class="widget margin-top-10 no-padding full-height"
             [ngClass]="this.currentCardSize">
          <mat-card appearance="outlined" class="cluster-summary-card">
            <mat-card-title class="center-xs">Compliance Summary</mat-card-title>
            <mat-card-content>
              <div>
                <ngx-charts-line-chart
                [view]="complianceSummaryLineChartAttributes.view"
                [scheme]="complianceSummaryLineChartAttributes.colorScheme"
                [results]="complianceSummaryLineChartAttributes.results"
                [legend]="complianceSummaryLineChartAttributes.showLegend"
                [legendPosition]="complianceSummaryLineChartAttributes.legendPosition"
                [gradient]="complianceSummaryLineChartAttributes.gradient"
                [xAxis]="complianceSummaryLineChartAttributes.showXAxis"
                [yAxis]="complianceSummaryLineChartAttributes.showYAxis"
                [showXAxisLabel]="complianceSummaryLineChartAttributes.showXAxisLabel"
                [showYAxisLabel]="complianceSummaryLineChartAttributes.showYAxisLabel"
                [yAxisLabel]="complianceSummaryLineChartAttributes.yAxisLabel"
                [xAxisLabel]="complianceSummaryLineChartAttributes.xAxisLabel"
                [yScaleMin]="complianceSummaryLineChartAttributes.yScaleMin"
                [yScaleMax]="complianceSummaryLineChartAttributes.yScaleMax"
                [yAxisTicks]="complianceSummaryLineChartAttributes.yAxisTicks"
                [xAxisTickFormatting]="scanXTickFormatting"
                [autoScale]="complianceSummaryLineChartAttributes.autoScale"
                style="font-size: 11px">
                  <ng-template #tooltipTemplate let-model="model">
                  <span>
                    Date: {{ model.name | date: 'mediumDate' }}
                  </span>
                    <br/>
                    <span>Compliance: {{ model.value | number: '1.0-1' }}%</span>
                  </ng-template>

                  <ng-template #seriesTooltipTemplate let-model="model">
                  <span>
                    Date: {{ model[0].name | date: 'mediumDate' }}
                  </span>
                    <br/>
                    <span>Compliance: {{ model[0].value | number: '1.0-1' }}%</span>
                  </ng-template>
              </ngx-charts-line-chart>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
        <div class="widget margin-top-10 no-padding full-height"
             [ngClass]="this.currentCardSize">
          <mat-card appearance="outlined" class="cluster-summary-card">
            <mat-card-title class="center-xs">Scan History</mat-card-title>
            <mat-card-content>
              <div>
                <ngx-charts-line-chart
                  [view]="lineChartAttributes.view"
                  [scheme]="lineChartAttributes.colorScheme"
                  [results]="lineChartAttributes.results"
                  [legend]="lineChartAttributes.showLegend"
                  [legendPosition]="lineChartAttributes.legendPosition"
                  [gradient]="lineChartAttributes.gradient"
                  [xAxis]="lineChartAttributes.showXAxis"
                  [yAxis]="lineChartAttributes.showYAxis"
                  [showXAxisLabel]="lineChartAttributes.showXAxisLabel"
                  [showYAxisLabel]="lineChartAttributes.showYAxisLabel"
                  [yAxisLabel]="lineChartAttributes.yAxisLabel"
                  [xAxisLabel]="lineChartAttributes.xAxisLabel"
                  [yScaleMin]="lineChartAttributes.yScaleMin"
                  [yAxisTicks]="lineChartAttributes.yAxisTicks"
                  [xAxisTickFormatting]="scanXTickFormatting"
                  [autoScale]="lineChartAttributes.autoScale">
                  <ng-template #tooltipTemplate let-model="model">
                  <span>
                    Date: {{ model.name | date: 'mediumDate' }}
                  </span>
                    <br/>
                    <span>Scans: {{ model.value }}</span>
                  </ng-template>

                  <ng-template #seriesTooltipTemplate let-model="model">
                  <span>
                    Date: {{ model[0].name | date: 'mediumDate' }}
                  </span>
                    <br/>
                    <span>Scans: {{ model[0].value }}</span>
                  </ng-template>

                </ngx-charts-line-chart>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
        <div class="widget margin-top-10 no-padding full-height"
             [ngClass]="this.currentCardSize">
          <mat-card appearance="outlined" class="cluster-summary-card">
            <mat-card-title class="center-xs">Historical Vulnerability Summary</mat-card-title>
            <mat-card-content>
              <div>
                <ngx-charts-bar-vertical-stacked
                  [view]="barChartAttributes.view"
                  [scheme]="barChartAttributes.colorScheme"
                  [results]="barChartAttributes.results"
                  [legend]="barChartAttributes.showLegend"
                  [legendPosition]="barChartAttributes.legendPosition"
                  [gradient]="barChartAttributes.gradient"
                  [xAxis]="barChartAttributes.showXAxis"
                  [yAxis]="barChartAttributes.showYAxis"
                  [barPadding]="barChartAttributes.barPadding"
                  [showXAxisLabel]="barChartAttributes.showXAxis"
                  [showYAxisLabel]="barChartAttributes.showYAxis"
                  [xAxisLabel]="barChartAttributes.xAxisLabel"
                  [yAxisLabel]="barChartAttributes.yAxisLabel"
                  [xAxisTickFormatting]="scanXTickFormatting">
                  <ng-template #tooltipTemplate let-model="model">
                    <span>Date: {{ model.series | date: 'mediumDate' }}</span>
                    <br/>
                    <span>Type: {{ model.name }}</span>
                    <br/>
                    <span>Vulnerabilities: {{ model.value }}</span>
                  </ng-template>
                </ngx-charts-bar-vertical-stacked>
              </div>
            </mat-card-content>
          </mat-card>
        </div>
      </div>
    </div>
    <div class="row">
      <div class="namespaces-table col-xs-12 no-padding">
        <mat-card appearance="outlined">
          <div class="namespace-image-table">
            <mat-table [dataSource]="dataSource" matSort  matSortActive="namespace" matSortDisableClear matSortDirection="asc">
              <ng-container  matColumnDef="namespace">
                <mat-header-cell class="padding-left" *matHeaderCellDef mat-sort-header disableClear>Namespaces</mat-header-cell>>
                <mat-cell class="padding-left" *matCellDef="let totalSeverity">{{totalSeverity.namespace}}</mat-cell>
              </ng-container>
              <ng-container matColumnDef="criticalIssues">
                <mat-header-cell class="justify-content-center" *matHeaderCellDef > Critical Issues</mat-header-cell>
                <mat-cell class="justify-content-center" *matCellDef="let totalSeverity"> {{totalSeverity.criticalIssues ? totalSeverity.criticalIssues : 0}} </mat-cell>>
              </ng-container>
              <ng-container matColumnDef="majorIssues">
                <mat-header-cell class="justify-content-center" *matHeaderCellDef > Major Issues</mat-header-cell>
                <mat-cell class="justify-content-center" *matCellDef="let totalSeverity"> {{totalSeverity.majorIssues ? totalSeverity.majorIssues : 0}} </mat-cell>
              </ng-container>
              <ng-container matColumnDef="mediumIssues">
                <mat-header-cell class="justify-content-center" *matHeaderCellDef>Medium Issues</mat-header-cell>>
                <mat-cell class="justify-content-center" *matCellDef="let totalSeverity"> {{totalSeverity.mediumIssues ? totalSeverity.mediumIssues: 0}} </mat-cell>
              </ng-container>
              <ng-container matColumnDef="lowIssues">
                <mat-header-cell class="justify-content-center" *matHeaderCellDef > Low Issues</mat-header-cell>
                <mat-cell class="justify-content-center" *matCellDef="let totalSeverity"> {{totalSeverity.lowIssues ? totalSeverity.lowIssues: 0}} </mat-cell>
              </ng-container>
              <ng-container matColumnDef="negligibleIssues">
                <mat-header-cell class="justify-content-center" *matHeaderCellDef >Negligible Issues</mat-header-cell>
                <mat-cell class="justify-content-center" *matCellDef="let totalSeverity"> {{totalSeverity.negligibleIssues ? totalSeverity.negligibleIssues: 0}} </mat-cell>
              </ng-container>

              <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>>
              <mat-row *matRowDef="let row; columns: displayedColumns;" (click)="getK8sPods(row)" class="image-click"></mat-row>>
            </mat-table>
          </div>
        </mat-card>
      </div>
    </div>
    <div class="cluster-events no-padding col-xs-12">
      <mat-card appearance="outlined" class="cluster-events-card">
        <h3>Logs</h3>
        <div
          class="search-results"
          infiniteScroll
          [infiniteScrollDistance]="2"
          [infiniteScrollThrottle]="50"
          (scrolled)="onScroll()"
          [scrollWindow]="false">
          <table>
            <tbody>
            <tr mdbTableCol [ngClass]="event.level === 'Error' ? 'cluster-error-event' : ''" *ngFor="let event of clusterEvents">
              <td (click)="openEventDetailsDialog(event)">{{(event?.createdDate) | date: 'yyyy-MM-dd hh:mm:ss'}}: {{event.description}}</td>
            </tr>
            </tbody>
          </table>
        </div>
      </mat-card>
    </div>
  </div>
</div>
